# ----------------------------------------------------------
# Author: Nandan Kumar
# Date: 10/27/2025
# Assignment-8: FastAPI Calculator
# File: docker-compose.yml
# ----------------------------------------------------------
# Description:
# Docker Compose configuration for running the FastAPI Calculator app.
# Simplifies container management with one command — builds the image,
# runs FastAPI with live reload, maps host ports, and checks container health.
# ----------------------------------------------------------

version: "3.9"

services:
  fastapi-calculator:
    container_name: fastapi-calculator
    build:
      context: .
      dockerfile: Dockerfile
    image: nandanksingh/module8_fastapi_calculator:latest

    ports:
      - "8000:8000"                       # Map host port → container port

    environment:
      PYTHONUNBUFFERED: "1"               # Show logs in real-time
      PYTHONDONTWRITEBYTECODE: "1"        # Prevent .pyc generation

    volumes:
      - .:/app                            # Mount current dir for hot reload (dev mode)

    command: >
      uvicorn main:app --host 0.0.0.0 --port 8000 --reload

    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:8000/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s                    # Small delay to allow startup before healthcheck

    restart: unless-stopped               # Auto-restart unless manually stopped
