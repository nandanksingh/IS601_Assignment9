# ----------------------------------------------------------
# Author: Nandan Kumar
# Date: 10/27/2025
# Assignment-8: FastAPI Calculator
# File: pytest.ini
# ----------------------------------------------------------
# Description:
# Central pytest configuration for organizing and running
# unit, integration, and end-to-end (Playwright) tests.
# Includes coverage thresholds, warning suppression, and
# detailed reporting for both local and CI/CD workflows.
# ----------------------------------------------------------

[pytest]

# ---------------------------------------
# Test Discovery and Paths
# ---------------------------------------
testpaths = tests
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# ---------------------------------------
# Markers (for test categorization)
# ---------------------------------------
markers =
    unit: marks tests as unit tests (fast, isolated)
    integration: marks tests as integration tests (API endpoints)
    e2e: marks tests as end-to-end tests (browser automation using Playwright)
    slow: marks tests as slow-running
    fast: marks tests as fast-running

# ---------------------------------------
# Test Output and Coverage Reporting
# ---------------------------------------
addopts =
    -v
    --tb=short
    --cov=app
    --cov=main
    --cov-report=term-missing
    --cov-report=html
    --cov-fail-under=90
    -m "not e2e"

# ---------------------------------------
# Coverage Config (omit non-testable code)
# ---------------------------------------
[coverage:run]
branch = True
omit =
    */__init__.py
    */venv/*
    */tests/*
    main.py:160-999  # exclude manual __main__ block from coverage

# ---------------------------------------
# Warnings and Logging Management
# ---------------------------------------
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning
    ignore::UserWarning
    ignore::RuntimeWarning

log_level = INFO
log_cli = True
log_cli_level = INFO
